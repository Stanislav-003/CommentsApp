@page "/register"
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Navigation
@inject ApiClient ApiClient
@using Microsoft.AspNetCore.Components.Authorization
@using frontend.Auth
@using frontend.Models
@using frontend.Responses

<h3>Register</h3>

<EditForm Model="@registerModel" OnValidSubmit="HandleRegister" FormName="registerForm">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div>
        <label>First Name:</label>
        <InputText @bind-Value="registerModel.FirstName" />
    </div>
    <div>
        <label>Last Name:</label>
        <InputText @bind-Value="registerModel.LastName" />
    </div>
    <div>
        <label>Email:</label>
        <InputText @bind-Value="registerModel.Email" />
    </div>
    <div>
        <label>Password:</label>
        <InputText @bind-Value="registerModel.Password" type="password" />
    </div>
    <div>
        <label>Confirm Password:</label>
        <InputText @bind-Value="registerModel.ConfirmPassword" type="password" />
    </div>
    <div>
        <label>Role:</label>
        <InputSelect @bind-Value="registerModel.Role">
            <option value="USER">USER</option>
            <option value="ADMIN">ADMIN</option>
        </InputSelect>
    </div>

    <button type="submit">Register</button>
</EditForm>

@code {
    public RegisterUserModel registerModel = new RegisterUserModel();

    public async Task HandleRegister()
    {
        var res = await ApiClient.PostAsync<RegisterResponseModel, RegisterUserModel>("/api/users/register", registerModel);
        if (res != null && res.Token != null)
        {
            await ((CustomAuthStateProvider)AuthStateProvider).MarkUserAsAuthenticated(res);
            Navigation.NavigateTo("/");
        }
    }
}